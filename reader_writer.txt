Thread synchronization and mutual exclusion using mutex. Application to
demonstrate : Reader – Writer problem with reader priority.
#include <stdio.h>
#include <pthread.h>
#include <unistd.h>
// Function prototypes
void* reader(void*);
void* writer(void*);
int writebuff();
void readbuff(int buffer);
// Shared buffer
int buff = 0;
// Synchronization variables
pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;
pthread_cond_t can_read = PTHREAD_COND_INITIALIZER;
pthread_cond_t can_write = PTHREAD_COND_INITIALIZER;
// State variables
int read_count = 0; // Number of active readers
int writer_active = 0; // 1 if a writer is active, else 0
// Reader thread function
void* reader(void* par)
{
 while (1)
 {
 pthread_mutex_lock(&lock);
 // Wait while a writer is active
 while (writer_active)
 {
 pthread_cond_wait(&can_read, &lock);
 }
 // One more reader entered
 read_count++;
 pthread_mutex_unlock(&lock);
 // ---- Critical section (Reading) ----
 readbuff(buff);
 usleep(500000); // Simulate reading time
 // -----------------------------------
 pthread_mutex_lock(&lock);
 read_count--;
 // If last reader left, notify writers
 if (read_count == 0)
 {
 pthread_cond_signal(&can_write);
 }
 pthread_mutex_unlock(&lock);
 usleep(100000); // Let others get chance
 }
 return NULL;
}
// Writer thread function
void* writer(void* par)
{
 while (1)
 {
 pthread_mutex_lock(&lock);
 // Wait until no readers and no writer active
 while (read_count > 0 || writer_active)
 {
 pthread_cond_wait(&can_write, &lock);
 }
 writer_active = 1; // Mark writer as active
 pthread_mutex_unlock(&lock);
 // ---- Critical section (Writing) ----
 buff = writebuff(); // Get value from user
 usleep(200000); // Simulate writing time
 // ------------------------------------
 pthread_mutex_lock(&lock);
 writer_active = 0;
 // First give preference to readers
 pthread_cond_broadcast(&can_read);
 // If no readers, allow writers
 pthread_cond_signal(&can_write);
 pthread_mutex_unlock(&lock);
 usleep(100000); // Let others get chance
 }
 return NULL;
}
// Writer takes input from user
int writebuff()
{
 int wv;
 printf("Writer: Enter a value to write in buffer: ");
 scanf("%d", &wv);
 return wv;
}
// Reader reads data from buffer
void readbuff(int buffer)
{
 printf("Reader is reading value = %d\n", buffer);
}
// Main function
int main()
{
 pthread_t r1, r2, w1;
 // Create readers and writers
 pthread_create(&r1, NULL, reader, NULL);
 pthread_create(&r2, NULL, reader, NULL);
 pthread_create(&w1, NULL, writer, NULL);
 // Join threads (runs indefinitely)
 pthread_join(r1, NULL);
 pthread_join(r2, NULL);
 pthread_join(w1, NULL);
 // Cleanup
 pthread_mutex_destroy(&lock);
 pthread_cond_destroy(&can_read);
 pthread_cond_destroy(&can_write);
 return 0;
}
Output :
bvcoew@bvcoew-Lenovo-S510:~$ cd Desktop
bvcoew@bvcoew-Lenovo-S510:~/Desktop$ cd te3311
bvcoew@bvcoew-Lenovo-S510:~/Desktop/te3311$ gcc pr4br.c
bvcoew@bvcoew-Lenovo-S510:~/Desktop/te3311$ ./a.out
Reader is reading value = 0
Reader is reading value = 0
Writer: Enter a value to write in buffer: 12
Reader is reading value = 12
Reader is reading value = 12
Writer: Enter a value to write in buffer: 34
Reader is reading value = 34
Reader is reading value = 34
Writer: Enter a value to write in buffer: 67
Reader is reading value = 67
Reader is reading value = 67
Thread synchronization and mutual exclusion using mutex. Application to
demonstrate : Reader – Writer problem with writer priority.
#include<stdio.h>
#include<pthread.h>
#include<unistd.h>
void* reader(void*);
void* writer(void*);
int writebuff();
void readbuff(int buffer);
pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;
int flag=0;
int buff;
int main()
{
pthread_t rid;
pthread_t wid;
pthread_create(&wid,NULL,writer,NULL);
pthread_create(&rid,NULL,reader,NULL);
pthread_join(wid,NULL);
pthread_join(rid,NULL);
pthread_mutex_destroy(&lock);
return 0;
}
void* reader(void* par)
{
while(1)
{
 pthread_mutex_lock(&lock);
 if(flag == 1)
 {
 readbuff(buff);
 flag = 0;
 }
 pthread_mutex_unlock(&lock);
 usleep(10000);
}
pthread_exit(NULL);
}
void* writer(void* par)
{
 while(1)
 {
 pthread_mutex_lock(&lock);
 if(flag == 0)
 {
 buff = writebuff();
 flag = 1;
 }
 pthread_mutex_unlock(&lock);
 usleep(10000);
}
pthread_exit(NULL);
}
int writebuff()
{
int wv;
printf("Writer is writing in Buffer\n");
scanf("%d",&wv);
return wv;
}
void readbuff(int buffer)
{
 printf("Reader is reading from buffer = %d \n",buffer);
}
Output :
bvcoew@bvcoew-Lenovo-S510:~$ cd Desktop
bvcoew@bvcoew-Lenovo-S510:~/Desktop$ cd te3311
bvcoew@bvcoew-Lenovo-S510:~/Desktop/te3311$ gcc pr4bw.c
bvcoew@bvcoew-Lenovo-S510:~/Desktop/te3311$ ./a.out
Writer is writing in Buffer
78
Reader is reading from buffer = 78
Writer is writing in Buffer
12
Reader is reading from buffer = 12
Writer is writing in Buffer
70
Reader is reading from buffer = 70
Writer is writing in Buffer
34
Reader is reading from buffer = 34